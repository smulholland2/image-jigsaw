!function(o){var s=function(i,t){if(this.elem=i,this.options=t,this.options.image=this.elem.children("img")[0].src,"undefined"==typeof this.options.image)return!1;var o=this,s=new Image;s.onload=function(){o.imageLoaded()},s.src=this.options.image};s.prototype.imageLoaded=function(){for(this.elem.append('<div class="jigsaw_panel_"></div>'),this.options.width=this.elem.children("img")[0].width,this.options.height=this.elem.children("img")[0].height,this.obj=this.elem.children(".jigsaw_panel_"),this.obj.css("width",parseInt(this.options.width)+parseInt(this.options.x*this.options.margin*2)+parseInt(this.options.error)+"px").css("height",parseInt(this.options.height)+parseInt(this.options.y*this.options.margin*2)+"px"),w=Math.floor(this.options.width/this.options.x),h=Math.floor(this.options.height/this.options.y),i=0;i<this.options.x;i++)for(j=0;j<this.options.y;j++){pos="block"+i+j,this.obj.append("<div pos='"+pos+"'></div>"),this.obj.children("div[pos='"+pos+"']").css("background-position","-"+j*w+"px -"+i*h+"px").css("width",w+"px").css("height",h+"px").css("background-image","url("+this.options.image+")").css("display","inline-block").css("margin",this.options.margin).css("background-repeat","no-repeat").css("transition","background-position .5s ease-out");var t=this;"object"==typeof this.options.callbacks&&null!=this.options.callbacks&&this.options.callbacks.forEach(function(i,o){t.obj.children('div[pos="'+pos+'"]').on(i.event,i.func)})}this.elem.children("img").hide(),this.obj.fadeIn(),this.animate(this.elem)},s.prototype.animate=function(o){w=Math.floor(this.options.width/this.options.x),h=Math.floor(this.options.height/this.options.y);var s=o.children(".jigsaw_panel_").children("div").length,n=[];if(this.options.distinct)for(i=0;i<this.options.x;i++)for(n[i]=[],j=0;j<this.options.y;j++)n[i][j]=!1;for(i=0;i<s;i++){var e=Math.floor(1e3*Math.random())%this.options.x,a=Math.floor(1e3*Math.random())%this.options.y;if(this.options.distinct&&n[e][a])for(x=0;x<this.options.x;x++)for(y=0;y<this.options.y;y++)if(!n[x][y]){e=x,a=y;break}n[e][a]=!0;var p="-"+e*w+"px -"+a*h+"px";o.children(".jigsaw_panel_").children("div:eq("+i+")").css("background-position",p)}var r=this;2==Math.floor(5*Math.random()+0)?t=setTimeout(function(){r.rearrange(o)},this.options.freq):t=setTimeout(function(){r.animate(o)},this.options.freq)},s.prototype.rearrange=function(o){for(w=Math.floor(this.options.width/this.options.x),h=Math.floor(this.options.height/this.options.y),i=0;i<this.options.x;i++)for(j=0;j<this.options.y;j++)pos="block"+i+j,o.children(".jigsaw_panel_").children("div[pos='"+pos+"']").css("background-position","-"+j*w+"px -"+i*h+"px").css("width",w+"px").css("height",h+"px").css("background-image","url("+this.options.image+")");var s=this;t=setTimeout(function(){s.animate(o)},this.options.freq)},o.fn.jigsaw=function(i){var t=o.extend({},o.fn.jigsaw.defaults,i);o(this).each(function(){return new s(o(this),t)})},o.fn.jigsaw.defaults={width:0,height:0,x:4,y:4,margin:1,error:16,freq:2e3,distinct:!0,image:"",callbacks:null}}(jQuery);